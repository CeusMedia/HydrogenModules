<?xml version="1.0"?>
<module>
	<title>Roles</title>
	<description>Basic role support and administration.</description>
	<version>0.3</version>
	<files>
		<class>Controller/Admin/Role.php5</class>
		<class>Model/Role.php5</class>
		<class>Model/Role/Right.php5</class>
		<class>View/Admin/Role.php5</class>
		<locale>de/admin/role.ini</locale>
		<template>admin/role/add.php</template>
		<template>admin/role/edit.php</template>
		<template>admin/role/edit.rights.php</template>
		<template>admin/role/index.php</template>
		<style>site.role.css</style>
	</files>
	<relations>
		<needs type="module">Users</needs>
	</relations>
	<config type="string" name="acl">CMF_Hydrogen_Environment_Resource_Acl_Database</config>
	<link xml:lang="de" access="acl" path="admin/role" rank="70">Rollen</link>
	<link xml:lang="en" access="acl" path="admin/role" rank="70">Roles</link>
	<sql on="install" type="mysql"><![CDATA[
DROP TABLE IF EXISTS `<%?prefix%>roles`;
CREATE TABLE IF NOT EXISTS `<%?prefix%>roles` (
  `roleId` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `access` tinyint(1) unsigned NOT NULL,
  `register` tinyint(1) unsigned NOT NULL,
  `title` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `description` text COLLATE utf8_unicode_ci NOT NULL,
  `createdAt` decimal(12,0) NOT NULL,
  `modifiedAt` decimal(12,0) NOT NULL,
  PRIMARY KEY (`roleId`),
  KEY `access` (`access`,`register`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

INSERT INTO `<%?prefix%>roles` (`roleId`, `access`, `register`, `title`, `description`, `createdAt`, `modifiedAt`) VALUES
(1, 128, 0, 'Entwickler', '', '1294083736', '0'),
(2, 128, 0, 'Administrator', '', '1294083928', '0'),
(3, 64, 0, 'Manager', '', '1294083948', '0'),
(4, 64, 64, 'Benutzer', '', '1294083995', '0'),
(5, 64, 128, 'Gast', '', '1294084004', '0');

DROP TABLE IF EXISTS `<%?prefix%>role_rights`;
CREATE TABLE IF NOT EXISTS `<%?prefix%>role_rights` (
  `roleRightId` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `roleId` int(11) unsigned NOT NULL,
  `controller` varchar(60) COLLATE utf8_unicode_ci NOT NULL,
  `action` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `timestamp` decimal(12,0) unsigned NOT NULL,
  PRIMARY KEY (`roleRightId`),
  KEY `roleId` (`roleId`,`controller`,`action`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
]]>
	</sql>
	<sql on="install" type="sqlite"><![CDATA[
DROP TABLE IF EXISTS "<%?prefix%>roles";
CREATE TABLE "<%?prefix%>roles" (
	"roleId" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,
	"access" INTEGER NOT NULL  DEFAULT 0,
	"register" INTEGER NOT NULL  DEFAULT 0,
	"title" VARCHAR NOT NULL ,
	"description" TEXT NOT NULL ,
	"createdAt" NUMERIC NOT NULL ,
	"modifiedAt" NUMERIC NOT NULL
);

INSERT INTO "<%?prefix%>roles" ('roleId', 'access', 'register', 'title', 'description', 'createdAt', 'modifiedAt') VALUES (1, 128, 0, 'Entwickler', '', '1294083736', '0');
INSERT INTO "<%?prefix%>roles" ('roleId', 'access', 'register', 'title', 'description', 'createdAt', 'modifiedAt') VALUES (2, 128, 0, 'Administrator', '', '1294083928', '0');
INSERT INTO "<%?prefix%>roles" ('roleId', 'access', 'register', 'title', 'description', 'createdAt', 'modifiedAt') VALUES (3, 64, 0, 'Manager', '', '1294083948', '0');
INSERT INTO "<%?prefix%>roles" ('roleId', 'access', 'register', 'title', 'description', 'createdAt', 'modifiedAt') VALUES (4, 64, 64, 'Benutzer', '', '1294083995', '0');
INSERT INTO "<%?prefix%>roles" ('roleId', 'access', 'register', 'title', 'description', 'createdAt', 'modifiedAt') VALUES (5, 64, 128, 'Gast', '', '1294084004', '0');

DROP TABLE IF EXISTS "<%?prefix%>role_rights";
CREATE TABLE "<%?prefix%>role_rights" (
	"roleRightId" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,
	"roleId" INTEGER NOT NULL ,
	"controller" VARCHAR NOT NULL ,
	"action" VARCHAR,
	"timestamp" NUMERIC NOT NULL
);
]]>
	</sql>
	<sql on="uninstall" type="*"><![CDATA[
DROP TABLE IF EXISTS `<%?prefix%>roles`;
DROP TABLE IF EXISTS `<%?prefix%>role_rights`;
]]>
	</sql>
</module>

