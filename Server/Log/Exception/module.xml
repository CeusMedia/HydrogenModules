<?xml version="1.0"?>
<module>
	<title>Server: Syslog</title>
	<description><![CDATA[Extends server by system log.
Sends mail to developer with exception trace if a developer mail address is defined.
This module can extend normal or server applications but will need an installed application base with mail support.]]></description>
	<category>Server</category>
	<version>0.2.1</version>
	<log version="0.1">Initial prototype.</log>
	<log version="0.2">Separation to Hydrogen module.</log>
	<log version="0.2.1">Use new mailer \CeusMedia\Mail from GitHub.</log>
	<company site="http://ceusmedia.de/">Ceus Media</company>
	<author email="christian.wuerker@ceusmedia.de">Christian W&#xFC;rker</author>
	<files>
		<class>Mail/Log/Exception.php5</class>
	</files>
	<config protected="yes" type="string" name="file" info="File name of exception log">exception.log</config>
	<config protected="yes" type="string" name="email" info="Mail address for exception report mail"></config>
	<relations>
		<needs type="module">Resource_Mail</needs>
	</relations>
	<hook type="resource" resource="Env" event="logException"><![CDATA[
		$pathLogs	= $env->getConfig()->get( 'path.logs' );
		$options	= $env->getConfig()->getAll( 'module.server_log_exception.', TRUE );

		$fileName	= pathLogs.$options->get( 'file' );
		if( !isset( $data['exception'] ) )
			throw new InvalidArgumentException( 'Missing exception in given hook call data' );
		$exception	= $data['exception'];

		$content	= $exception->getMessage();
		try{
			$content	= serialize( $exception );
		}
		catch( Exception $e ){}
		error_log( time().":".base64_encode( $content )."\n", 3, $fileName );

		if( $options->get( 'mail' ) ){
			$mail	= new Mail_Log_Exception( $env, array( 'exception' => $exception ) );
			$mail->sendTo( (object) array( 'email' => $options->get( 'mail' ) ) );
		}
		return TRUE;
]]></hook>
</module>
