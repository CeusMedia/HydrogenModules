<?xml version="1.0"?>
<module>
	<title>Info: Pages</title>
	<description><![CDATA[Support for static pages and automatic routing to them.]]></description>
	<category>Info</category>
	<version>0.8.2</version>
	<log version="0.5">Complete redesign with hook on App:onDispatch.</log>
	<log version="0.5.1">Switch to deny direct access to controller.</log>
	<log version="0.5.2">Added page content format.</log>
	<log version="0.5.3">Added hook View:onRenderContent for nested pages.</log>
	<log version="0.5.4">Extended database table by timestamps.</log>
	<log version="0.5.5">Added hook for sitemap data collection.</log>
	<log version="0.5.6">Improved sitemap data collection by subpages and order.</log>
	<log version="0.5.7">Merged SQL updates into SQL install script.</log>
	<log version="0.5.8">Add pages navigation helper for projects without module UI:Navigation.</log>
	<log version="0.5.9">Add new page status "deactivated" and avoid access.</log>
	<log version="0.6">Support sitemap information in model.</log>
	<log version="0.6.1">Support subpage resolution of module controlled pages.</log>
	<log version="0.6.2">Add default page content (which is empty) for empty pages.</log>
	<log version="0.6.3">Allow page resolution of empty node page and redirect to first child.</log>
	<log version="0.6.4">Redirect module page only if module path is not within linked page.</log>
	<log version="0.6.5">Set relation to module UI:MetaTags from optional to mandatory.</log>
	<log version="0.6.6">Support page icons.</log>
	<log version="0.6.7">Add hook to help controller classes to detect their URI path.</log>
	<log version="0.6.8">Allow pages modules to call controller method by requested path.</log>
	<log version="0.6.9">Prefix all form elements with namespace.</log>
	<log version="0.7">Change module column to controller and action.</log>
	<log version="0.7.1">Support search module.</log>
	<log version="0.7.2">Support page access.</log>
	<log version="0.7.3">Add language support using module Resource:Localization.</log>
	<log version="0.7.4">Disable page dispatching on backend app instances.</log>
	<log version="0.7.5">Identify page by controller and action.</log>
	<log version="0.7.6">Extract hooks to own hook class.</log>
	<log version="0.7.7">Improve and localize hook.</log>
	<log version="0.7.8">Adjust to new shortcode handling.</log>
	<log version="0.7.9">Cleanup and documentation.</log>
	<log version="0.8">Improve dispatching.</log>
	<log version="0.8.1">Refactor page detection to work by recursion.</log>
	<log version="0.8.2">Add component page type.</log> 
	<company site="https://ceusmedia.de/">Ceus Media</company>
	<author email="christian.wuerker@ceusmedia.de">Christian W&#xFC;rker</author>
	<license source="http://www.gnu.org/licenses/gpl-3.0.txt">GPL 3</license>
	<files>
		<class>Controller/Info/Page.php5</class>
		<class>Hook/Info/Page.php5</class>
		<class>Logic/Page.php5</class>
		<class>Model/Page.php5</class>
		<class>View/Info/Page.php5</class>
		<class>View/Helper/Navigation/Pages/Navbar.php5</class>
		<locale>de/info/pages.ini</locale>
		<locale>de/html/info/page/empty.html</locale>
		<locale>en/info/pages.ini</locale>
		<locale>en/html/info/page/empty.html</locale>
	</files>
	<config type="string" protected="yes" name="title.separator"> - </config>
	<config type="string" protected="yes" name="direct" values="allowed,denied">denied</config>
	<config type="boolean" protected="yes" name="sitemap">yes</config>
	<relations>
		<needs type="module">Resource_Database</needs>
		<needs type="module">UI_MetaTags</needs>
		<supports type="module">Resource_Localization</supports>
	</relations>
	<hook type="resource" resource="App" event="onDispatch">Hook_Info_Page::onAppDispatch</hook>
	<hook type="resource" resource="View" event="onRenderContent">Hook_Info_Page::onRenderContent</hook>
	<hook type="resource" resource="Sitemap" event="registerLinks">Hook_Info_Page::onRegisterSitemapLinks</hook>
	<hook type="resource" resource="Controller" event="onDetectPath">Hook_Info_Page::onControllerDetectPath</hook>
	<hook type="resource" resource="Env" event="constructEnd">Hook_Info_Page::onEnvConstructEnd</hook>
	<sql on="install" type="mysql" version="final"><![CDATA[
DROP TABLE IF EXISTS `<%?prefix%>pages`;
CREATE TABLE IF NOT EXISTS `<%?prefix%>pages` (
  `pageId` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `parentId` int(10) UNSIGNED DEFAULT '0',
  `status` tinyint(1) DEFAULT '0',
  `type` tinyint(4) DEFAULT '0',
  `scope` int(10) UNSIGNED DEFAULT '0',
  `rank` tinyint(1) NOT NULL,
  `identifier` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `controller` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `action` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `access` varchar(10) COLLATE utf8_unicode_ci NOT NULL DEFAULT 'public',
  `title` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `content` text COLLATE utf8_unicode_ci,
  `format` varchar(20) COLLATE utf8_unicode_ci DEFAULT 'HTML',
  `description` text COLLATE utf8_unicode_ci,
  `keywords` text COLLATE utf8_unicode_ci,
  `changefreq` varchar(8) COLLATE utf8_unicode_ci NOT NULL DEFAULT 'weekly',
  `priority` float UNSIGNED NOT NULL DEFAULT '0.5',
  `icon` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,
  `createdAt` decimal(12,0) UNSIGNED NOT NULL,
  `modifiedAt` decimal(12,0) UNSIGNED DEFAULT NULL,
  PRIMARY KEY (`pageId`),
  KEY `parentId` (`parentId`),
  KEY `status` (`status`),
  KEY `type` (`type`),
  KEY `scope` (`scope`),
  KEY `identifier` (`identifier`),
  KEY `controller` (`controller`),
  KEY `action` (`action`),
  KEY `access` (`access`),
  KEY `format` (`format`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
]]></sql>
	<sql on="install" type="mysql" version="0.1"><![CDATA[
DROP TABLE IF EXISTS `<%?prefix%>pages`;
CREATE TABLE IF NOT EXISTS `<%?prefix%>pages` (
  `pageId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `parentId` int(10) unsigned DEFAULT '0',
  `status` tinyint(1) DEFAULT '0',
  `type` tinyint(4) DEFAULT '0',
  `scope` int(10) unsigned DEFAULT '0',
  `rank` tinyint(1) NOT NULL,
  `identifier` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `module` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `title` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `content` text COLLATE utf8_unicode_ci,
  `format` varchar(20) COLLATE utf8_unicode_ci DEFAULT 'HTML',
  `description` text COLLATE utf8_unicode_ci,
  `keywords` text COLLATE utf8_unicode_ci,
  `createdAt` decimal(12,0) unsigned NOT NULL,
  `modifiedAt` decimal(12,0) unsigned DEFAULT NULL,
  PRIMARY KEY (`pageId`),
  KEY `parentId` (`parentId`),
  KEY `status` (`status`),
  KEY `type` (`type`),
  KEY `scope` (`scope`),
  KEY `identifier` (`identifier`),
  KEY `module` (`module`),
  KEY `format` (`format`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
]]></sql>
	<sql on="update" type="mysql" version="0.6"><![CDATA[
ALTER TABLE `<%?prefix%>pages` ADD `changefreq` VARCHAR(8) NOT NULL DEFAULT 'weekly' AFTER `keywords`, ADD `priority` FLOAT UNSIGNED NOT NULL DEFAULT '0.5' AFTER `changefreq`;
]]></sql>
	<sql on="update" type="mysql" version="0.6.6"><![CDATA[
ALTER TABLE `<%?prefix%>pages` ADD `icon` VARCHAR(30) DEFAULT NULL AFTER `priority`;
]]></sql>
	<sql on="update" type="mysql" version="0.7"><![CDATA[
ALTER TABLE `<%?prefix%>pages` CHANGE `module` `controller` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_unicode_ci NULL;
ALTER TABLE `<%?prefix%>pages` ADD `action` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_unicode_ci NULL AFTER `controller`, ADD INDEX (`action`);
]]></sql>
	<sql on="update" type="mysql" version="0.7.2"><![CDATA[
ALTER TABLE `<%?prefix%>pages` ADD `access` VARCHAR( 10 ) NOT NULL DEFAULT 'public' AFTER `action` ,
ADD INDEX ( `access` ) ;
]]></sql>
	<sql on="uninstall" type="mysql"><![CDATA[
DROP TABLE IF EXISTS `<%?prefix%>pages`;
]]></sql>
</module>
